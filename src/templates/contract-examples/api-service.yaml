roles:
  - id: architect
    scope: ["src/**", "tests/**", "README.md"]
    authority: { allowedCommands: ["npm test"], allowedPaths: [] }
    outputExpectations: ["plan artifacts", "tech decisions"]
    verificationMethod: { kind: "none" }
    budget: { maxIterations: 2, exhaustionEscalation: "exception_gate" }
  - id: worker
    scope: ["src/**", "tests/**"]
    authority: { allowedCommands: ["npm test"], allowedPaths: [] }
    outputExpectations: ["implementation"]
    verificationMethod: { kind: "none" }
    budget: { maxIterations: 3, exhaustionEscalation: "architect" }

sharedScopes:
  - roles: ["architect", "worker"]
    patterns: ["src/**", "tests/**"]

phases:
  - id: discovery
    actors: ["architect"]
    inputBoundaries: ["**/*"]
    outputBoundaries: ["vision.md", "architecture.md"]
    preconditions: [{ type: "always" }]
    completionCriteria:
      - { type: "artifact_exists", pattern: "vision.md" }
      - { type: "artifact_exists", pattern: "architecture.md" }
    successors: [{ on: "done", next: "execution" }]
  - id: execution
    actors: ["worker"]
    inputBoundaries: ["src/**", "tests/**"]
    outputBoundaries: ["src/**", "tests/**"]
    preconditions: [{ type: "always" }]
    completionCriteria:
      - { type: "command_succeeds", command: "npm test" }
    successors: []
    isTerminal: true

gates:
  - id: ship
    trigger: "discovery->execution"
    audience: "PO"
    requiredInputs:
      - { name: "vision", kind: "path", value: "vision.md" }
      - { name: "architecture", kind: "path", value: "architecture.md" }
    outcomes: { approve: "execution", reject: "discovery" }

globalLifetime:
  maxTimeMs: 1800000

escalationChain: []
